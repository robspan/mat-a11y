/**
 * mat-a11y GUI Demo - Auto-generated from real GUI
 * This file is generated by: node dev/generate-examples.js
 *
 * Static demo version that works without a server.
 * Uses embedded results from a real scan.
 */

(function() {
  'use strict';

  // Embedded scan results (from real analysis)
  const DEMO_RESULTS = {"totalIssues":1088,"componentCount":218,"totalComponentsScanned":309,"audits":[{"name":"buttonNames","weight":10,"passed":false,"elementsFound":757,"errors":5,"warnings":0,"issues":5},{"name":"duplicateIdAria","weight":10,"passed":false,"elementsFound":293,"errors":2,"warnings":0,"issues":2},{"name":"formLabels","weight":10,"passed":false,"elementsFound":287,"errors":99,"warnings":0,"issues":99},{"name":"matChipListLabel","weight":10,"passed":false,"elementsFound":8,"errors":4,"warnings":0,"issues":4},{"name":"matRadioGroupLabel","weight":10,"passed":false,"elementsFound":2,"errors":1,"warnings":0,"issues":1},{"name":"matSliderLabel","weight":10,"passed":false,"elementsFound":3,"errors":1,"warnings":0,"issues":1},{"name":"cdkTrapFocusDialog","weight":7,"passed":false,"elementsFound":10,"errors":4,"warnings":0,"issues":4},{"name":"clickWithoutKeyboard","weight":7,"passed":false,"elementsFound":5887,"errors":11,"warnings":0,"issues":11},{"name":"clickWithoutRole","weight":7,"passed":false,"elementsFound":5887,"errors":13,"warnings":0,"issues":13},{"name":"emptyTableHeader","weight":7,"passed":false,"elementsFound":34,"errors":1,"warnings":0,"issues":1},{"name":"matIconAccessibility","weight":7,"passed":false,"elementsFound":2008,"errors":115,"warnings":0,"issues":115},{"name":"matProgressSpinnerLabel","weight":7,"passed":false,"elementsFound":84,"errors":1,"warnings":0,"issues":1},{"name":"scopeAttrMisuse","weight":7,"passed":false,"elementsFound":13,"errors":8,"warnings":0,"issues":8},{"name":"colorContrast","weight":7,"passed":false,"elementsFound":9598,"errors":279,"warnings":20,"issues":299},{"name":"hoverWithoutFocus","weight":7,"passed":false,"elementsFound":27,"errors":14,"warnings":0,"issues":14},{"name":"outlineNoneWithoutAlt","weight":7,"passed":false,"elementsFound":242,"errors":3,"warnings":0,"issues":3},{"name":"touchTargets","weight":5,"passed":false,"elementsFound":1199,"errors":59,"warnings":0,"issues":59},{"name":"headingOrder","weight":3,"passed":false,"elementsFound":615,"errors":2,"warnings":0,"issues":2},{"name":"ariaAttributes","weight":10,"passed":true,"elementsFound":3214,"errors":0,"warnings":0,"issues":0},{"name":"ariaRoles","weight":10,"passed":true,"elementsFound":676,"errors":0,"warnings":0,"issues":0},{"name":"imageAlt","weight":10,"passed":true,"elementsFound":37,"errors":0,"warnings":0,"issues":0},{"name":"matAutocompleteLabel","weight":10,"passed":true,"elementsFound":1,"errors":0,"warnings":0,"issues":0},{"name":"matCheckboxLabel","weight":10,"passed":true,"elementsFound":25,"errors":0,"warnings":0,"issues":0},{"name":"matDatepickerLabel","weight":10,"passed":true,"elementsFound":6,"errors":0,"warnings":0,"issues":0},{"name":"matFormFieldLabel","weight":10,"passed":true,"elementsFound":174,"errors":0,"warnings":0,"issues":0},{"name":"matSelectPlaceholder","weight":10,"passed":true,"elementsFound":12,"errors":0,"warnings":0,"issues":0},{"name":"tableHeaders","weight":10,"passed":true,"elementsFound":7,"errors":0,"warnings":0,"issues":0},{"name":"dlStructure","weight":7,"passed":true,"elementsFound":1,"errors":0,"warnings":0,"issues":0},{"name":"formFieldName","weight":7,"passed":true,"elementsFound":30,"errors":0,"warnings":0,"issues":0},{"name":"linkNames","weight":7,"passed":true,"elementsFound":135,"errors":0,"warnings":0,"issues":0},{"name":"listStructure","weight":7,"passed":true,"elementsFound":100,"errors":0,"warnings":0,"issues":0},{"name":"matButtonType","weight":7,"passed":true,"elementsFound":389,"errors":0,"warnings":0,"issues":0},{"name":"matDialogFocus","weight":7,"passed":true,"elementsFound":24,"errors":0,"warnings":8,"issues":8},{"name":"matExpansionHeader","weight":7,"passed":true,"elementsFound":2,"errors":0,"warnings":0,"issues":0},{"name":"matMenuTrigger","weight":7,"passed":true,"elementsFound":4,"errors":0,"warnings":0,"issues":0},{"name":"matProgressBarLabel","weight":7,"passed":true,"elementsFound":8,"errors":0,"warnings":0,"issues":0},{"name":"matSidenavA11y","weight":7,"passed":true,"elementsFound":1,"errors":0,"warnings":0,"issues":0},{"name":"matStepLabel","weight":7,"passed":true,"elementsFound":6,"errors":0,"warnings":0,"issues":0},{"name":"matTabLabel","weight":7,"passed":true,"elementsFound":3,"errors":0,"warnings":0,"issues":0},{"name":"matTableHeaders","weight":7,"passed":true,"elementsFound":5,"errors":0,"warnings":0,"issues":0},{"name":"matTooltipKeyboard","weight":7,"passed":true,"elementsFound":62,"errors":0,"warnings":1,"issues":1},{"name":"routerLinkNames","weight":7,"passed":true,"elementsFound":32,"errors":0,"warnings":0,"issues":0},{"name":"tabindex","weight":7,"passed":true,"elementsFound":54,"errors":0,"warnings":0,"issues":0},{"name":"uniqueIds","weight":7,"passed":true,"elementsFound":292,"errors":0,"warnings":0,"issues":0},{"name":"focusStyles","weight":7,"passed":true,"elementsFound":7541,"errors":0,"warnings":0,"issues":0},{"name":"autofocusUsage","weight":5,"passed":true,"elementsFound":4,"errors":0,"warnings":4,"issues":4},{"name":"cdkAriaDescriber","weight":5,"passed":true,"elementsFound":3,"errors":0,"warnings":2,"issues":2},{"name":"cdkLiveAnnouncer","weight":5,"passed":true,"elementsFound":12,"errors":0,"warnings":11,"issues":11},{"name":"pointerEventsNone","weight":5,"passed":true,"elementsFound":5,"errors":0,"warnings":5,"issues":5},{"name":"prefersReducedMotion","weight":5,"passed":true,"elementsFound":441,"errors":0,"warnings":121,"issues":121},{"name":"innerHtmlUsage","weight":3,"passed":true,"elementsFound":26,"errors":0,"warnings":26,"issues":26},{"name":"ngForTrackBy","weight":3,"passed":true,"elementsFound":98,"errors":0,"warnings":5,"issues":5},{"name":"skipLink","weight":3,"passed":true,"elementsFound":15,"errors":0,"warnings":0,"issues":0},{"name":"contentOverflow","weight":3,"passed":true,"elementsFound":8850,"errors":0,"warnings":171,"issues":171},{"name":"focusWithinSupport","weight":3,"passed":true,"elementsFound":204,"errors":0,"warnings":0,"issues":0},{"name":"lineHeightTight","weight":3,"passed":true,"elementsFound":941,"errors":0,"warnings":7,"issues":7},{"name":"smallFontSize","weight":3,"passed":true,"elementsFound":3844,"errors":0,"warnings":81,"issues":81},{"name":"textJustify","weight":3,"passed":true,"elementsFound":1,"errors":0,"warnings":1,"issues":1},{"name":"userSelectNone","weight":3,"passed":true,"elementsFound":27,"errors":0,"warnings":0,"issues":0},{"name":"visibilityHiddenUsage","weight":3,"passed":true,"elementsFound":5,"errors":0,"warnings":3,"issues":3}],"auditScore":66};

  // ==========================================================================
  // DOM Elements
  // ==========================================================================

  const elements = {
    expertToggle: document.getElementById('expert-mode'),
    darkModeBtn: document.getElementById('dark-mode-btn'),
    scanForm: document.getElementById('scan-form'),
    scanButton: document.getElementById('scan-button'),
    copyCliBtn: document.getElementById('copy-cli'),
    cliPreview: document.getElementById('cli-preview'),
    scanPanel: document.querySelector('.scan-panel'),
    progressPanel: document.getElementById('progress-panel'),
    progressText: document.getElementById('progress-text'),
    progressStages: document.querySelectorAll('.progress-stage'),
    resultsPanel: document.getElementById('results-panel'),
    errorPanel: document.getElementById('error-panel'),
    previewPanel: document.getElementById('preview-panel'),
    newScanBtn: document.getElementById('new-scan-btn'),
    totalIssues: document.getElementById('total-issues'),
    componentsCount: document.getElementById('components-count'),
    statIssuesSimple: document.getElementById('stat-issues-simple'),
    statComponentsSimple: document.getElementById('stat-components-simple'),
    statScoreSimple: document.getElementById('stat-score-simple'),
    statFiles: document.getElementById('stat-files'),
    statTime: document.getElementById('stat-time'),
    statChecks: document.getElementById('stat-checks'),
    statCritical: document.getElementById('stat-critical'),
    statHigh: document.getElementById('stat-high'),
    statMedium: document.getElementById('stat-medium')
  };

  // ==========================================================================
  // Progress Animation
  // ==========================================================================

  const PROGRESS_MESSAGES = [
    { stage: 'find', text: 'Finding component files...' },
    { stage: 'analyze', text: 'Analyzing component structure...' },
    { stage: 'check', text: 'Running accessibility checks...' },
    { stage: 'report', text: 'Generating report...' }
  ];

  let progressInterval = null;

  function startProgressAnimation() {
    let currentStage = 0;
    updateProgressStage(currentStage);

    progressInterval = setInterval(() => {
      currentStage++;
      if (currentStage < PROGRESS_MESSAGES.length) {
        updateProgressStage(currentStage);
      }
    }, 400); // Fast for demo
  }

  function updateProgressStage(stageIndex) {
    const message = PROGRESS_MESSAGES[stageIndex];
    if (elements.progressText) {
      elements.progressText.textContent = message.text;
    }

    elements.progressStages.forEach((el, i) => {
      el.classList.remove('completed');
      el.removeAttribute('aria-current');
      if (i < stageIndex) {
        el.classList.add('completed');
      } else if (i === stageIndex) {
        el.setAttribute('aria-current', 'step');
      }
    });
  }

  function stopProgressAnimation() {
    if (progressInterval) {
      clearInterval(progressInterval);
      progressInterval = null;
    }
    elements.progressStages.forEach(el => {
      el.classList.add('completed');
      el.removeAttribute('aria-current');
    });
  }

  // ==========================================================================
  // UI State Management
  // ==========================================================================

  function showPanel(panelName) {
    elements.scanPanel.hidden = panelName !== 'scan';
    elements.progressPanel.hidden = panelName !== 'progress';
    elements.resultsPanel.hidden = panelName !== 'results';
    if (elements.errorPanel) elements.errorPanel.hidden = panelName !== 'error';
    if (elements.previewPanel) elements.previewPanel.hidden = panelName !== 'preview';

    window.scrollTo(0, 0);

    if (panelName === 'results') {
      elements.resultsPanel.focus();
      announceToScreenReader('Demo scan complete. Results are now available.');
    } else if (panelName === 'progress') {
      announceToScreenReader('Simulating accessibility scan...');
    }
  }

  function announceToScreenReader(message) {
    const el = document.createElement('div');
    el.setAttribute('role', 'status');
    el.setAttribute('aria-live', 'polite');
    el.setAttribute('aria-atomic', 'true');
    el.style.cssText = 'position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;';
    el.textContent = message;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 1000);
  }

  // ==========================================================================
  // Dark Mode
  // ==========================================================================

  function initDarkMode() {
    const saved = localStorage.getItem('mat-a11y-dark-mode');
    const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (saved === 'true' || (saved === null && systemDark)) {
      document.body.classList.add('dark-mode');
    }

    if (elements.darkModeBtn) {
      elements.darkModeBtn.addEventListener('click', () => {
        const isDark = document.body.classList.toggle('dark-mode');
        localStorage.setItem('mat-a11y-dark-mode', isDark);
        announceToScreenReader(isDark ? 'Dark mode enabled' : 'Light mode enabled');
      });
    }

    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (localStorage.getItem('mat-a11y-dark-mode') === null) {
        document.body.classList.toggle('dark-mode', e.matches);
      }
    });
  }

  // ==========================================================================
  // Expert Mode
  // ==========================================================================

  function initExpertMode() {
    const saved = localStorage.getItem('mat-a11y-expert-mode');
    if (saved === 'true') {
      elements.expertToggle.checked = true;
      document.body.classList.add('expert-mode');
    }

    elements.expertToggle.addEventListener('change', (e) => {
      const isExpert = e.target.checked;
      document.body.classList.toggle('expert-mode', isExpert);
      localStorage.setItem('mat-a11y-expert-mode', isExpert);
      updateCliPreview();
      announceToScreenReader(isExpert ? 'Expert mode enabled' : 'Expert mode disabled');
    });
  }

  // ==========================================================================
  // CLI Preview
  // ==========================================================================

  function updateCliPreview() {
    if (!elements.cliPreview) return;
    const tier = document.querySelector('input[name="tier"]:checked')?.value || 'full';
    let cmd = 'npx mat-a11y';
    if (tier !== 'full') cmd += ' --tier ' + tier;
    elements.cliPreview.textContent = cmd;
  }

  function initCliCopy() {
    if (!elements.copyCliBtn) return;

    elements.copyCliBtn.addEventListener('click', async () => {
      const cmd = elements.cliPreview?.textContent || '';
      try {
        await navigator.clipboard.writeText(cmd);
        elements.copyCliBtn.classList.add('copied');
        const original = elements.copyCliBtn.innerHTML;
        elements.copyCliBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Copied!';
        announceToScreenReader('Command copied');
        setTimeout(() => {
          elements.copyCliBtn.classList.remove('copied');
          elements.copyCliBtn.innerHTML = original;
        }, 2000);
      } catch (e) {
        console.warn('Copy failed:', e);
      }
    });
  }

  // ==========================================================================
  // Collapsible Sections
  // ==========================================================================

  function initCollapsibles() {
    document.querySelectorAll('.collapsible-header').forEach(header => {
      header.addEventListener('click', () => {
        const expanded = header.getAttribute('aria-expanded') === 'true';
        const contentId = header.getAttribute('aria-controls');
        const content = document.getElementById(contentId);
        header.setAttribute('aria-expanded', !expanded);
        if (content) content.hidden = expanded;
      });
    });
  }

  // ==========================================================================
  // Demo Scan
  // ==========================================================================

  function initScanForm() {
    elements.scanForm.addEventListener('submit', handleDemoScan);
    elements.newScanBtn.addEventListener('click', () => showPanel('scan'));

    document.querySelectorAll('input[name="tier"]').forEach(radio => {
      radio.addEventListener('change', updateCliPreview);
    });
  }

  async function handleDemoScan(e) {
    e.preventDefault();

    showPanel('progress');
    startProgressAnimation();
    elements.scanButton.disabled = true;

    // Simulate scan time
    await new Promise(r => setTimeout(r, 1800));

    stopProgressAnimation();
    displayResults(DEMO_RESULTS);
    showPanel('results');
    elements.scanButton.disabled = false;
  }

  function displayResults(results) {
    const total = results.totalIssues || 0;
    const comps = results.componentCount || 0;
    const files = results.totalComponentsScanned || 0;
    const score = results.auditScore;

    // Summary
    if (elements.totalIssues) elements.totalIssues.textContent = total;
    if (elements.componentsCount) elements.componentsCount.textContent = comps;

    // Simple mode stats
    if (elements.statIssuesSimple) elements.statIssuesSimple.textContent = total;
    if (elements.statComponentsSimple) elements.statComponentsSimple.textContent = comps;
    if (elements.statScoreSimple) {
      elements.statScoreSimple.textContent = score !== null && score !== undefined ? score : '--';
      if (score !== null && score !== undefined) {
        const color = score >= 80 ? 'var(--color-success)' : score >= 50 ? 'var(--color-warning)' : 'var(--color-error)';
        elements.statScoreSimple.style.color = color;
      }
    }

    // Expert stats
    if (elements.statFiles) elements.statFiles.textContent = files;
    if (elements.statTime) elements.statTime.textContent = '1.8s';
    if (elements.statChecks) elements.statChecks.textContent = results.audits?.length || 82;

    // Count by severity
    let critical = 0, high = 0, medium = 0;
    if (results.audits) {
      for (const audit of results.audits) {
        const w = audit.weight || 5;
        const issues = audit.issues || 0;
        if (w >= 10) critical += issues;
        else if (w >= 7) high += issues;
        else medium += issues;
      }
    }

    if (elements.statCritical) elements.statCritical.textContent = critical;
    if (elements.statHigh) elements.statHigh.textContent = high;
    if (elements.statMedium) elements.statMedium.textContent = medium;

    // Update success icon
    const icon = document.querySelector('.success-icon');
    if (icon) {
      if (total === 0) {
        icon.style.background = 'var(--color-success-bg)';
        icon.style.color = 'var(--color-success)';
        icon.innerHTML = '&#10003;';
      } else if (total <= 10) {
        icon.style.background = 'var(--color-warning-bg)';
        icon.style.color = 'var(--color-warning)';
        icon.innerHTML = '!';
      } else {
        icon.style.background = 'var(--color-error-bg)';
        icon.style.color = 'var(--color-error)';
        icon.innerHTML = '!!';
      }
    }
  }

  // ==========================================================================
  // Export Buttons (Demo Mode - just show samples)
  // ==========================================================================

  function initExport() {
    document.querySelectorAll('.export-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const format = btn.dataset.format;
        if (!format) return;

        // Map format to sample file
        const files = {
          'html': '../_report-html.html',
          'pdf': '../_report-html.html',
          'ai': '../_report-ai.backlog.txt',
          'json': '../_report-json.json',
          'csv': '../_report-csv.csv',
          'markdown': '../_report-markdown.md',
          'sarif': '../_report-sarif.sarif.json',
          'junit': '../_report-junit.xml',
          'github-annotations': '../_report-github-annotations.txt',
          'gitlab-codequality': '../_report-gitlab-codequality.json',
          'checkstyle': '../_report-checkstyle.xml',
          'sonarqube': '../_report-sonarqube.json',
          'prometheus': '../_report-prometheus.prom',
          'grafana-json': '../_report-grafana-json.json',
          'datadog': '../_report-datadog.json',
          'slack': '../_report-slack.json',
          'discord': '../_report-discord.json',
          'teams': '../_report-teams.json'
        };

        const file = files[format];
        if (file) {
          window.open(file, '_blank');
        }
      });
    });
  }

  // ==========================================================================
  // Keyboard Navigation
  // ==========================================================================

  function initKeyboardNav() {
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (!elements.resultsPanel.hidden) {
          showPanel('scan');
          elements.scanButton.focus();
        }
      }
    });
  }

  // ==========================================================================
  // Initialization
  // ==========================================================================

  function init() {
    initDarkMode();
    initExpertMode();
    initScanForm();
    initExport();
    initKeyboardNav();
    initCliCopy();
    initCollapsibles();
    updateCliPreview();

    elements.resultsPanel.setAttribute('tabindex', '-1');
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

})();
